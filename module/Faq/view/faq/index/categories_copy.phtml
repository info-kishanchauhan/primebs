<?php $this->headTitle("Help Center | Prime Digital Arena"); ?>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">


<style>
body {
  font-family: 'Inter', sans-serif;
  background: #f4f5fa;
  margin: 0;
  padding: 0;
}
.faq-topbar {
  background: linear-gradient(2deg, #5b46b3, #9f1ac6);
  padding: 70px 20px 40px;
  text-align: center;
  color: white;
  
  }
.faq-topbar h1 {
  font-size: 40px;
  font-weight: 700;
  margin-bottom: 10px;
}
.faq-topbar p {
  font-size: 14px;
  color: #e5e5e5;
}
.faq-search {
  max-width: 700px;
  margin: -28px auto 40px;
  z-index: 10;
  position: relative;
}
.faq-search input {
  width: 100%;
  padding: 15px 20px;
  border-radius: 10px;
  border: none;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  font-size: 15px;
}
.category-grid {
  max-width: 800px;
  margin: 0 auto 60px;
  display: flex;
  flex-direction: column;
  gap: 14px;
}
.category-box {
  background: white;
  padding: 18px 22px;
  border-radius: 12px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  transition: 0.2s ease;
  box-shadow: 0 2px 6px rgb(108 108 108 / 22%);
  flex-direction: column;
}
.category-box:hover {
  box-shadow: 0 6px 16px rgba(0,0,0,0.06);
  transform: translateY(-2px);
  cursor: pointer;
}
.category-info {
  display: flex;
  flex-direction: column;
}
.category-name {
  font-weight: 600;
  font-size: 15px;
  color: #333;
}
.category-meta {
  font-size: 13px;
  color: #777;
  margin-top: 4px;
}
.category-arrow {
  font-size: 20px;
  color: #bbb;
}
.category-form input,
.add-category-form input {
  font-size: 14px;
  padding: 6px 10px;
  border-radius: 6px;
  border: 1px solid #ccc;
  margin-bottom: 5px;
  width: 300px;
}
.category-form button {
  background: #7d2491;
  color: white;
  font-size: 13px;
  padding: 6px 14px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  margin-left: 6px;
}
.add-category-form {
  max-width: 800px;
  margin: 0 auto 30px;
  background: white;
  padding: 18px 22px;
  border-radius: 12px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.03);
}
.no-results {
  text-align: center;
  font-size: 16px;
  color: #999;
  padding: 30px;
}
button {
  color: white;
  font-size: 13px;
  padding: 6px 14px;
  margin: 2px;
  border: none;
  border-radius: 6px;
  transition: 0.2s ease-in-out;
}
.category-form-button {
  background-color: #5b46b3;
}
.top-articles {
  max-width: 800px;
  margin: 0 auto 60px;
  padding: 30px 22px;
  background: white;
  border-radius: 12px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.04);
}
.top-articles h2 {
  font-size: 18px;
  font-weight: 700;
  margin-bottom: 20px;
}
.top-articles ul {
  padding: 0;
  list-style: none;
  margin: 0;
}
.top-articles li {
  margin-bottom: 10px;
  font-size: 15px;
}
.top-articles a {
  color: #7d2491;
  text-decoration: none;
  font-weight: 600;
}
.top-articles a:hover {
  text-decoration: underline;
}
.help-footer {
  background: #ffffff;
  border-top: 1px solid #e5e7eb;
  margin-top: 60px;
  padding: 30px 20px;
  font-family: 'Inter', sans-serif;
  text-align: center;
  font-size: 14px;
  color: #777;
}
.help-footer a {
  color: #7d2491;
  text-decoration: none;
  margin: 0 8px;
  font-weight: 500;
}
.help-footer a:hover {
  text-decoration: underline;
}
  
  #bs-main-content-container {
    padding-top: 0px; !important
    padding-bottom: 30px !important
}
  
  .container-fluid {
    padding-right: 0px;
    padding-left: 0px;
    margin-right: auto;
    margin-left: auto;
}

</style>

<!-- Topbar -->

<div class="faq-topbar">
  
  <h1>How can we help?</h1>
  <p>Search or browse by topic to find what you need.</p>
</div>

<!-- Search -->
<div class="faq-search">
  <input type="text" id="searchInput" onkeyup="filterCategories()" placeholder="Search for articles...">
</div><br>

<?php if ($_SESSION['user_id'] == '0' || $_SESSION['STAFFUSER'] == '1'): ?>
  <form class="add-category-form" method="post" action="/faq/add-category">
  <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 12px;">Add New Category</h3>
  <input type="text" name="name" placeholder="Category Name" required>

  <select name="visibility" required>
  <option value="all" <?= $cat['visibility'] == 'all' ? 'selected' : '' ?>>All Users</option>
  <option value="enterprise" <?= $cat['visibility'] == 'enterprise' ? 'selected' : '' ?>>Enterprise Only</option>
  <option value="admin" <?= $cat['visibility'] == 'admin' ? 'selected' : '' ?>>Admin / Team Only</option>
</select>


  <button type="submit">Add</button>
</form>

<?php endif; ?>
<?php
  $userType = isset($_SESSION['user_type']) ? strtolower(trim($_SESSION['user_type'])) : '';
  $isAdminOrTeam = (isset($_SESSION['STAFFUSER']) && $_SESSION['STAFFUSER'] == '1') || (isset($_SESSION['user_id']) && $_SESSION['user_id'] == '0');

  if ($isAdminOrTeam) {
    $allowed = ['all', 'enterprise', 'admin'];
  } elseif ($userType === 'enterprise') {
    $allowed = ['all', 'enterprise'];
  } else {
    $allowed = ['all'];
  }
?>

<div class="category-grid" id="categoryList">
  <?php foreach ($categories as $cat): ?>
    <?php if (!in_array(strtolower(trim($cat['visibility'])), $allowed)) continue; ?>

  
    <div class="category-box">
      <?php if ($_SESSION['user_id'] == '0' || $_SESSION['STAFFUSER'] == '1'): ?>
        <div onclick="window.location.href='/faq/category/<?php echo $cat['id']; ?>';" style="width: 100%; display: flex; justify-content: space-between; align-items: center;">
          <div class="category-info">
            <div class="category-name" id="title_<?php echo $cat['id']; ?>"><?php echo $cat['name']; ?></div>
            <div class="category-meta" id="meta_<?php echo $cat['id']; ?>"><?php echo $cat['article_count']; ?> articles</div>
          </div>
          <div style="display: flex; gap: 6px;">
            <button type="button" onclick="event.stopPropagation(); editCategory(<?php echo $cat['id']; ?>);" class="category-form-button">Edit</button>
            <form method="post" action="/faq/delete-category" style="display:inline;" onsubmit="event.stopPropagation(); return confirm('Delete this category?');">
              <input type="hidden" name="id" value="<?php echo $cat['id']; ?>">
              <button type="submit" class="category-form-button" style="background: #e74c3c;">Delete</button>
            </form>
          </div>
        </div>
        <form class="category-form" method="post" action="/faq/update-category" id="form_<?php echo $cat['id']; ?>" style="display:none; margin-top: 10px;width: 100%;">
            <select name="visibility" required style="margin-left: 10px; padding: 6px 10px; border-radius: 6px; border: 1px solid #ccc;">
    <option value="all" <?php if($cat['visibility']=='all') echo 'selected'; ?>>All Users</option>
    <option value="enterprise" <?php if($cat['visibility']=='enterprise') echo 'selected'; ?>>Enterprise Only</option>
    <option value="admin" <?php if($cat['visibility']=='admin') echo 'selected'; ?>>Admin / Team Only</option>
  </select>

          <input type="hidden" name="id" value="<?php echo $cat['id']; ?>">
          <input type="text" name="name" value="<?php echo $cat['name']; ?>" required>
          <button type="submit">Save</button>
        </form>
      <?php else: ?>
        <div onclick="window.location.href='/faq/category/<?php echo $cat['id']; ?>';" style="width: 100%; display: flex; justify-content: space-between; align-items: center;">
          <div class="category-info">
            <div class="category-name"><?php echo $cat['name']; ?></div>
            <div class="category-meta"><?php echo $cat['article_count']; ?> articles</div>
          </div>
          <div class="category-arrow">&#x279C;</div>
        </div>
      <?php endif; ?>
    </div>
  <?php endforeach; ?>
</div>

<div id="noResults" class="no-results" style="display:none;">No matching categories found.</div>

<?php if (!empty($topArticles)): ?>
  <div class="top-articles-box">
    <h3 class="top-articles-title">ðŸ“š Most Searched Articles</h3>
    <ul class="top-articles-list">
      <?php foreach ($topArticles as $a): ?>
        <li>
          <a href="/faq/article/<?php echo $a['id']; ?>">
            <?php echo $this->escapeHtml($a['question']); ?>
          </a>
          <span class="arrow">&rarr;</span>
        </li>
      <?php endforeach; ?>
    </ul>
  </div>

  <style>
    .top-articles-box {
      max-width: 840px;
      margin: 60px auto 30px;
      padding: 40px;
      background: #ffffff;
      border-radius: 20px;
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.05);
      font-family: 'Inter', sans-serif;
    }

    .top-articles-title {
      font-size: 22px;
      font-weight: 700;
      margin-bottom: 25px;
      color: #1f2937;
      border-bottom: 2px solid #f1f1f1;
      padding-bottom: 10px;
    }

    .top-articles-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .top-articles-list li {
      padding: 15px 0;
      border-bottom: 1px solid #eee;
      font-size: 15px;
      font-weight: 500;
      color: #374151;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: background 0.3s;
    }

    .top-articles-list li:last-child {
      border-bottom: none;
    }

    .top-articles-list li a {
      color: #7d2491;
      text-decoration: none;
      transition: color 0.2s;
      flex: 1;
    }

    .top-articles-list li:hover {
      background: #f9f9ff;
    }

    .top-articles-list li a:hover {
      color: #a000ff;
      text-decoration: underline;
    }

    .top-articles-list .arrow {
      font-size: 16px;
      color: #ccc;
      margin-left: 10px;
    }
  </style>
<?php endif; ?>


<div class="help-footer">
  Prime Digital Arena Â© <?php echo date('Y'); ?>. All rights reserved.
  &nbsp;|&nbsp;
  <a href="https://primedigitalarena.com/privacy" target="_blank">Privacy</a>
  |
  <a href="https://primedigitalarena.com/Terms" target="_blank">Terms</a>
</div>

<?php
  $userType = isset($_SESSION['user_type']) ? strtolower($_SESSION['user_type']) : '';
  $isEnterprise = ($userType === 'enterprise');
  $isAdminOrTeam = (isset($_SESSION['STAFFUSER']) && $_SESSION['STAFFUSER'] == '1') || (isset($_SESSION['user_id']) && $_SESSION['user_id'] == '0');
?>

<script>
function editCategory(id) {
  document.getElementById('form_' + id).style.display = 'block';
}

function filterCategories() {
  const input = document.getElementById("searchInput").value.toLowerCase();
  const items = document.querySelectorAll(".category-box");
  let visibleCount = 0;

  items.forEach(box => {
    const content = box.innerText.toLowerCase();
    if (content.includes(input)) {
      box.style.display = "flex";
      visibleCount++;
    } else {
      box.style.display = "none";
    }
  });

  document.getElementById("noResults").style.display = visibleCount === 0 ? "block" : "none";
}
</script>